# Ancela

**AI Assistant**

Ancela is an AI-powered memory assistant that helps users manage todos, access their calendar, read emails, and interact with contacts through SMS messaging. Built with .NET Aspire, Azure Functions, Azure Cosmos DB, and Microsoft Graph, it provides an intelligent, conversational interface for managing personal information and productivity.

## Features

- ğŸ’¬ **SMS Interface** - Interact with your AI assistant via text messages using Twilio
- ğŸ§  **AI-Powered Conversations** - Powered by OpenAI GPT models with Semantic Kernel
- ğŸ“ **Todo Management** - Save, retrieve, and delete todos using natural language
- ï¿½ **Calendar Access** - Query your upcoming events and appointments
- ğŸ“§ **Email Integration** - Read recent emails and send new emails
- ğŸ‘¥ **Contact Management** - Access and search your contacts
- ï¿½ğŸ” **Session Management** - Secure, per-user sessions with simple commands
- ğŸ“œ **Conversation History** - Maintains context across multiple interactions
- â˜ï¸ **Cloud Native** - Built with .NET Aspire for easy deployment to Azure
- ğŸ—„ï¸ **Scalable Storage** - Azure Cosmos DB for reliable, distributed data storage

## Architecture

Ancela is built using modern cloud-native patterns:

- **Ancela.AppHost** - .NET Aspire orchestration and infrastructure
- **Ancela.FunctionApp** - Azure Functions for serverless HTTP endpoints
- **Ancela.ServiceDefaults** - Shared service configuration and defaults

### Key Components

- **CommandInterceptor** - Handles special commands (`hello ancela`, `goodbye ancela`)
- **ChatService** - AI conversation management with OpenAI integration
- **TodoService** - CRUD operations for user todos in Cosmos DB
- **KnowledgeService** - Manages persistent knowledge entries
- **GraphService** - Microsoft Graph API integration for calendar, email, and contacts
- **GraphPlugin** - Semantic Kernel plugin exposing Graph capabilities to AI
- **SessionService** - User session lifecycle management
- **HistoryService** - Conversation history persistence and retrieval
- **SmsService** - Twilio integration for SMS messaging

## Prerequisites

- [.NET 10.0 SDK](https://dotnet.microsoft.com/download/dotnet/10.0) or later
- [Azure subscription](https://azure.microsoft.com/free/) (for deployment)
- [Twilio account](https://www.twilio.com/) (for SMS functionality)
- [OpenAI API key](https://platform.openai.com/) or Azure OpenAI service

## Getting Started

### Local Development

1. **Clone the repository**
   ```bash
   git clone https://github.com/tombly/ancela.git
   cd ancela
   ```

2. **Configure user secrets**
   
   Navigate to the AppHost project and set your secrets:
   ```bash
   cd Ancela.AppHost
   dotnet user-secrets set Parameters:openai-api-key "your-openai-api-key"
   dotnet user-secrets set Parameters:twilio-account-sid "your-twilio-account-sid"
   dotnet user-secrets set Parameters:twilio-auth-token "your-twilio-auth-token"
   dotnet user-secrets set Parameters:twilio-phone-number "your-twilio-phone-number"
   ```

3. **Update the resource group name**
   
   Edit `FixedNameInfrastructureResolver.cs` to set your Azure resource group name.

4. **Run locally**
   ```bash
   dotnet run --project Ancela.AppHost
   ```

   The Aspire dashboard will launch, showing all running services and their endpoints.

### Deployment to Azure

1. **Configure infrastructure**
   
   The project uses .NET Aspire for infrastructure-as-code. Bicep templates generated by Aspire are generated in `Ancela.AppHost/aspire-output/`.

2. **Deploy using Aspire**
   ```bash
   azd init
   azd up
   ```

   Aspire will prompt you for required secrets during deployment. You can easily grab them from the user secrets:
   ```bash
   cd Ancela.AppHost
   dotnet user-secrets list | grep Parameters
   ```

3. **Post-deployment configuration**

   After deploying, grant your Entra principal the Contributor role for Cosmos DB so you can access Data Explorer and create the Cosmos DB database and containers:
   ```bash
   ./configure_cosmos.sh
   ```

## Usage

### Starting a Session

Send an SMS to your Twilio number:
```
hello ancela
```

Response:
```
Welcome! I'm your AI memory assistant. I can help you save and retrieve todos via SMS. Try sending me a todo!
```

### Saving Todos

Simply send natural language messages:
```
Remember that my dentist appointment is next Tuesday at 2pm
```

```
Save a todo: buy milk, eggs, and bread
```

### Retrieving Todos

Ask for your todos in natural language:
```
What todos do I have?
```

```
List my todos
```

```
Do I have any appointments?
```

### Deleting Todos

Request deletion naturally:
```
Delete the todo about the dentist
```

```
Remove the grocery list
```

### Checking Your Calendar

Ask about your schedule:
```
What's on my calendar today?
```

```
Do I have any meetings tomorrow?
```

```
Show me my calendar for next week
```

### Reading Emails

Check your recent messages:
```
Do I have any new emails?
```

```
Show me my recent emails
```

```
What's in my inbox?
```

### Sending Emails

Send emails through natural conversation:
```
Send an email to john@example.com about the project status
```

```
Email Sarah and let her know the meeting is rescheduled
```

### Looking Up Contacts

Find contact information:
```
What's John's email address?
```

```
Find Sarah's phone number
```

```
Show me my contacts
```

### Ending a Session

When you're done:
```
goodbye ancela
```

Response:
```
Goodbye! Your session has been ended. Your todos have been preserved. Send 'hello ancela' to start a new session.
```

## Configuration

### Environment Variables

The following environment variables are used (configured via user secrets in development):

- `Parameters:openai-api-key` - Your OpenAI API key
- `Parameters:twilio-account-sid` - Twilio account SID
- `Parameters:twilio-auth-token` - Twilio auth token
- `Parameters:twilio-phone-number` - Your Twilio phone number

## Project Structure

```
Ancela/
â”œâ”€â”€ Ancela.AppHost/           # Aspire orchestration
â”‚   â”œâ”€â”€ AppHost.cs             # Service definitions
â”‚   â”œâ”€â”€ aspire-output/         # Generated Bicep templates
â”‚   â””â”€â”€ FixedNameInfrastructureResolver.cs
â”œâ”€â”€ Ancela.FunctionApp/       # Azure Functions app
â”‚   â”œâ”€â”€ CommandInterceptor.cs # Command handling
â”‚   â”œâ”€â”€ CosmosPlugin.cs        # Semantic Kernel plugin
â”‚   â”œâ”€â”€ IncomingMessage.cs     # HTTP message endpoint
â”‚   â”œâ”€â”€ IncomingSms.cs         # Twilio webhook endpoint
â”‚   â””â”€â”€ Services/              # Business logic services
â”‚       â”œâ”€â”€ ChatService.cs
â”‚       â”œâ”€â”€ HistoryService.cs
â”‚       â”œâ”€â”€ TodoService.cs
â”‚       â”œâ”€â”€ SessionService.cs
â”‚       â””â”€â”€ SmsService.cs
â””â”€â”€ Ancela.ServiceDefaults/   # Shared configuration
```

## Data Model

### Sessions
- Partitioned by `agentPhoneNumber`
- Tracks active user sessions
- Stores user timezone preferences

### Todos
- Partitioned by `agentPhoneNumber`
- Associated with `userPhoneNumber`
- Supports soft deletion
- Preserved when sessions end

### History
- Partitioned by `agentPhoneNumber`
- Maintains conversation context
- One entry per user message and AI response

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

---

**Made with â¤ï¸ using .NET Aspire**
